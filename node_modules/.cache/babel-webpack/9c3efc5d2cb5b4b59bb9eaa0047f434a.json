{"ast":null,"code":"// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n/**\n * @fileoverview Defines an {@linkplain cmd.Executor command executor} that\n * communicates with a remote end using HTTP + JSON.\n */\n'use strict';\n\nvar _classCallCheck = require(\"C:/Users/NeverMind/IntelliJIDEAProjects/argon-dashboard-angular-master/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/NeverMind/IntelliJIDEAProjects/argon-dashboard-angular-master/node_modules/@babel/runtime/helpers/createClass\");\n\nvar http = require('http');\n\nvar https = require('https');\n\nvar url = require('url');\n\nvar httpLib = require('../lib/http');\n/**\n * @typedef {{protocol: (?string|undefined),\n *            auth: (?string|undefined),\n *            hostname: (?string|undefined),\n *            host: (?string|undefined),\n *            port: (?string|undefined),\n *            path: (?string|undefined),\n *            pathname: (?string|undefined)}}\n */\n\n\nvar RequestOptions;\n/**\n * @param {string} aUrl The request URL to parse.\n * @return {RequestOptions} The request options.\n * @throws {Error} if the URL does not include a hostname.\n */\n\nfunction getRequestOptions(aUrl) {\n  var options = url.parse(aUrl);\n\n  if (!options.hostname) {\n    throw new Error('Invalid URL: ' + aUrl);\n  } // Delete the search and has portions as they are not used.\n\n\n  options.search = null;\n  options.hash = null;\n  options.path = options.pathname;\n  return options;\n}\n/**\n * A basic HTTP client used to send messages to a remote end.\n *\n * @implements {httpLib.Client}\n */\n\n\nvar HttpClient = /*#__PURE__*/function () {\n  /**\n   * @param {string} serverUrl URL for the WebDriver server to send commands to.\n   * @param {http.Agent=} opt_agent The agent to use for each request.\n   *     Defaults to `http.globalAgent`.\n   * @param {?string=} opt_proxy The proxy to use for the connection to the\n   *     server. Default is to use no proxy.\n   */\n  function HttpClient(serverUrl, opt_agent, opt_proxy) {\n    _classCallCheck(this, HttpClient);\n\n    /** @private {http.Agent} */\n    this.agent_ = opt_agent || null;\n    /**\n     * Base options for each request.\n     * @private {RequestOptions}\n     */\n\n    this.options_ = getRequestOptions(serverUrl);\n    /**\n     * @private {?RequestOptions}\n     */\n\n    this.proxyOptions_ = opt_proxy ? getRequestOptions(opt_proxy) : null;\n  }\n  /** @override */\n\n\n  _createClass(HttpClient, [{\n    key: \"send\",\n    value: function send(httpRequest) {\n      var _this = this;\n\n      var data;\n      var headers = {};\n      httpRequest.headers.forEach(function (value, name) {\n        headers[name] = value;\n      });\n      headers['Content-Length'] = 0;\n\n      if (httpRequest.method == 'POST' || httpRequest.method == 'PUT') {\n        data = JSON.stringify(httpRequest.data);\n        headers['Content-Length'] = Buffer.byteLength(data, 'utf8');\n        headers['Content-Type'] = 'application/json;charset=UTF-8';\n      }\n\n      var path = this.options_.path;\n\n      if (path.endsWith('/') && httpRequest.path.startsWith('/')) {\n        path += httpRequest.path.substring(1);\n      } else {\n        path += httpRequest.path;\n      }\n\n      var parsedPath = url.parse(path);\n      var options = {\n        agent: this.agent_ || null,\n        method: httpRequest.method,\n        auth: this.options_.auth,\n        hostname: this.options_.hostname,\n        port: this.options_.port,\n        protocol: this.options_.protocol,\n        path: parsedPath.path,\n        pathname: parsedPath.pathname,\n        search: parsedPath.search,\n        hash: parsedPath.hash,\n        headers: headers\n      };\n      return new Promise(function (fulfill, reject) {\n        sendRequest(options, fulfill, reject, data, _this.proxyOptions_);\n      });\n    }\n  }]);\n\n  return HttpClient;\n}();\n/**\n * Sends a single HTTP request.\n * @param {!Object} options The request options.\n * @param {function(!httpLib.Response)} onOk The function to call if the\n *     request succeeds.\n * @param {function(!Error)} onError The function to call if the request fails.\n * @param {?string=} opt_data The data to send with the request.\n * @param {?RequestOptions=} opt_proxy The proxy server to use for the request.\n */\n\n\nfunction sendRequest(options, onOk, onError, opt_data, opt_proxy) {\n  var hostname = options.hostname;\n  var port = options.port;\n\n  if (opt_proxy) {\n    var proxy =\n    /** @type {RequestOptions} */\n    opt_proxy; // RFC 2616, section 5.1.2:\n    // The absoluteURI form is REQUIRED when the request is being made to a\n    // proxy.\n\n    var absoluteUri = url.format(options); // RFC 2616, section 14.23:\n    // An HTTP/1.1 proxy MUST ensure that any request message it forwards does\n    // contain an appropriate Host header field that identifies the service\n    // being requested by the proxy.\n\n    var targetHost = options.hostname;\n\n    if (options.port) {\n      targetHost += ':' + options.port;\n    } // Update the request options with our proxy info.\n\n\n    options.headers['Host'] = targetHost;\n    options.path = absoluteUri;\n    options.host = proxy.host;\n    options.hostname = proxy.hostname;\n    options.port = proxy.port;\n\n    if (proxy.auth) {\n      options.headers['Proxy-Authorization'] = 'Basic ' + new Buffer(proxy.auth).toString('base64');\n    }\n  }\n\n  var requestFn = options.protocol === 'https:' ? https.request : http.request;\n  var request = requestFn(options, function onResponse(response) {\n    if (response.statusCode == 302 || response.statusCode == 303) {\n      try {\n        var location = url.parse(response.headers['location']);\n      } catch (ex) {\n        onError(Error('Failed to parse \"Location\" header for server redirect: ' + ex.message + '\\nResponse was: \\n' + new httpLib.Response(response.statusCode, response.headers, '')));\n        return;\n      }\n\n      if (!location.hostname) {\n        location.hostname = hostname;\n        location.port = port;\n      }\n\n      request.abort();\n      sendRequest({\n        method: 'GET',\n        protocol: location.protocol || options.protocol,\n        hostname: location.hostname,\n        port: location.port,\n        path: location.path,\n        pathname: location.pathname,\n        search: location.search,\n        hash: location.hash,\n        headers: {\n          'Accept': 'application/json; charset=utf-8'\n        }\n      }, onOk, onError, undefined, opt_proxy);\n      return;\n    }\n\n    var body = [];\n    response.on('data', body.push.bind(body));\n    response.on('end', function () {\n      var resp = new httpLib.Response(\n      /** @type {number} */\n      response.statusCode,\n      /** @type {!Object<string>} */\n      response.headers, body.join('').replace(/\\0/g, ''));\n      onOk(resp);\n    });\n  });\n  request.on('error', function (e) {\n    if (e.code === 'ECONNRESET') {\n      setTimeout(function () {\n        sendRequest(options, onOk, onError, opt_data, opt_proxy);\n      }, 15);\n    } else {\n      var message = e.message;\n\n      if (e.code) {\n        message = e.code + ' ' + message;\n      }\n\n      onError(new Error(message));\n    }\n  });\n\n  if (opt_data) {\n    request.write(opt_data);\n  }\n\n  request.end();\n} // PUBLIC API\n\n\nexports.Executor = httpLib.Executor;\nexports.HttpClient = HttpClient;\nexports.Request = httpLib.Request;\nexports.Response = httpLib.Response;","map":{"version":3,"sources":["C:/Users/NeverMind/IntelliJIDEAProjects/argon-dashboard-angular-master/node_modules/selenium-webdriver/http/index.js"],"names":["http","require","https","url","httpLib","RequestOptions","getRequestOptions","aUrl","options","parse","hostname","Error","search","hash","path","pathname","HttpClient","serverUrl","opt_agent","opt_proxy","agent_","options_","proxyOptions_","httpRequest","data","headers","forEach","value","name","method","JSON","stringify","Buffer","byteLength","endsWith","startsWith","substring","parsedPath","agent","auth","port","protocol","Promise","fulfill","reject","sendRequest","onOk","onError","opt_data","proxy","absoluteUri","format","targetHost","host","toString","requestFn","request","onResponse","response","statusCode","location","ex","message","Response","abort","undefined","body","on","push","bind","resp","join","replace","e","code","setTimeout","write","end","exports","Executor","Request"],"mappings":"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","sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\n/**\n * @fileoverview Defines an {@linkplain cmd.Executor command executor} that\n * communicates with a remote end using HTTP + JSON.\n */\n\n'use strict';\n\nconst http = require('http');\nconst https = require('https');\nconst url = require('url');\n\nconst httpLib = require('../lib/http');\n\n\n/**\n * @typedef {{protocol: (?string|undefined),\n *            auth: (?string|undefined),\n *            hostname: (?string|undefined),\n *            host: (?string|undefined),\n *            port: (?string|undefined),\n *            path: (?string|undefined),\n *            pathname: (?string|undefined)}}\n */\nvar RequestOptions;\n\n\n/**\n * @param {string} aUrl The request URL to parse.\n * @return {RequestOptions} The request options.\n * @throws {Error} if the URL does not include a hostname.\n */\nfunction getRequestOptions(aUrl) {\n  let options = url.parse(aUrl);\n  if (!options.hostname) {\n    throw new Error('Invalid URL: ' + aUrl);\n  }\n  // Delete the search and has portions as they are not used.\n  options.search = null;\n  options.hash = null;\n  options.path = options.pathname;\n  return options;\n}\n\n\n/**\n * A basic HTTP client used to send messages to a remote end.\n *\n * @implements {httpLib.Client}\n */\nclass HttpClient {\n  /**\n   * @param {string} serverUrl URL for the WebDriver server to send commands to.\n   * @param {http.Agent=} opt_agent The agent to use for each request.\n   *     Defaults to `http.globalAgent`.\n   * @param {?string=} opt_proxy The proxy to use for the connection to the\n   *     server. Default is to use no proxy.\n   */\n  constructor(serverUrl, opt_agent, opt_proxy) {\n    /** @private {http.Agent} */\n    this.agent_ = opt_agent || null;\n\n    /**\n     * Base options for each request.\n     * @private {RequestOptions}\n     */\n    this.options_ = getRequestOptions(serverUrl);\n\n    /**\n     * @private {?RequestOptions}\n     */\n    this.proxyOptions_ = opt_proxy ? getRequestOptions(opt_proxy) : null;\n  }\n\n  /** @override */\n  send(httpRequest) {\n    let data;\n\n    let headers = {};\n    httpRequest.headers.forEach(function(value, name) {\n      headers[name] = value;\n    });\n\n    headers['Content-Length'] = 0;\n    if (httpRequest.method == 'POST' || httpRequest.method == 'PUT') {\n      data = JSON.stringify(httpRequest.data);\n      headers['Content-Length'] = Buffer.byteLength(data, 'utf8');\n      headers['Content-Type'] = 'application/json;charset=UTF-8';\n    }\n\n    let path = this.options_.path;\n    if (path.endsWith('/') && httpRequest.path.startsWith('/')) {\n      path += httpRequest.path.substring(1);\n    } else {\n      path += httpRequest.path;\n    }\n    let parsedPath = url.parse(path);\n\n    let options = {\n      agent: this.agent_ || null,\n      method: httpRequest.method,\n\n      auth: this.options_.auth,\n      hostname: this.options_.hostname,\n      port: this.options_.port,\n      protocol: this.options_.protocol,\n\n      path: parsedPath.path,\n      pathname: parsedPath.pathname,\n      search: parsedPath.search,\n      hash: parsedPath.hash,\n\n      headers,\n    };\n\n    return new Promise((fulfill, reject) => {\n      sendRequest(options, fulfill, reject, data, this.proxyOptions_);\n    });\n  }\n}\n\n\n/**\n * Sends a single HTTP request.\n * @param {!Object} options The request options.\n * @param {function(!httpLib.Response)} onOk The function to call if the\n *     request succeeds.\n * @param {function(!Error)} onError The function to call if the request fails.\n * @param {?string=} opt_data The data to send with the request.\n * @param {?RequestOptions=} opt_proxy The proxy server to use for the request.\n */\nfunction sendRequest(options, onOk, onError, opt_data, opt_proxy) {\n  var hostname = options.hostname;\n  var port = options.port;\n\n  if (opt_proxy) {\n    let proxy = /** @type {RequestOptions} */(opt_proxy);\n\n    // RFC 2616, section 5.1.2:\n    // The absoluteURI form is REQUIRED when the request is being made to a\n    // proxy.\n    let absoluteUri = url.format(options);\n\n    // RFC 2616, section 14.23:\n    // An HTTP/1.1 proxy MUST ensure that any request message it forwards does\n    // contain an appropriate Host header field that identifies the service\n    // being requested by the proxy.\n    let targetHost = options.hostname\n    if (options.port) {\n      targetHost += ':' + options.port;\n    }\n\n    // Update the request options with our proxy info.\n    options.headers['Host'] = targetHost;\n    options.path = absoluteUri;\n    options.host = proxy.host;\n    options.hostname = proxy.hostname;\n    options.port = proxy.port;\n\n    if (proxy.auth) {\n      options.headers['Proxy-Authorization'] =\n          'Basic ' + new Buffer(proxy.auth).toString('base64');\n    }\n  }\n\n  let requestFn = options.protocol === 'https:' ? https.request : http.request;\n  var request = requestFn(options, function onResponse(response) {\n    if (response.statusCode == 302 || response.statusCode == 303) {\n      try {\n        var location = url.parse(response.headers['location']);\n      } catch (ex) {\n        onError(Error(\n            'Failed to parse \"Location\" header for server redirect: ' +\n            ex.message + '\\nResponse was: \\n' +\n            new httpLib.Response(response.statusCode, response.headers, '')));\n        return;\n      }\n\n      if (!location.hostname) {\n        location.hostname = hostname;\n        location.port = port;\n      }\n\n      request.abort();\n      sendRequest({\n        method: 'GET',\n        protocol: location.protocol || options.protocol,\n        hostname: location.hostname,\n        port: location.port,\n        path: location.path,\n        pathname: location.pathname,\n        search: location.search,\n        hash: location.hash,\n        headers: {\n          'Accept': 'application/json; charset=utf-8'\n        }\n      }, onOk, onError, undefined, opt_proxy);\n      return;\n    }\n\n    var body = [];\n    response.on('data', body.push.bind(body));\n    response.on('end', function() {\n      var resp = new httpLib.Response(\n          /** @type {number} */(response.statusCode),\n          /** @type {!Object<string>} */(response.headers),\n          body.join('').replace(/\\0/g, ''));\n      onOk(resp);\n    });\n  });\n\n  request.on('error', function(e) {\n    if (e.code === 'ECONNRESET') {\n      setTimeout(function() {\n        sendRequest(options, onOk, onError, opt_data, opt_proxy);\n      }, 15);\n    } else {\n      var message = e.message;\n      if (e.code) {\n        message = e.code + ' ' + message;\n      }\n      onError(new Error(message));\n    }\n  });\n\n  if (opt_data) {\n    request.write(opt_data);\n  }\n\n  request.end();\n}\n\n\n// PUBLIC API\n\nexports.Executor = httpLib.Executor;\nexports.HttpClient = HttpClient;\nexports.Request = httpLib.Request;\nexports.Response = httpLib.Response;\n"]},"metadata":{},"sourceType":"script"}